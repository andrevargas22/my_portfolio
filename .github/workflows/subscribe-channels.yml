name: YouTube Channel Subscription Maintenance

on:
  # 1st day of every month at 6:00 AM UTC (3:00 AM BRT)
  schedule:
    - cron: '0 6 1 * *'
  
  # Allow manual execution
  workflow_dispatch:

jobs:
  subscribe-channels:
    runs-on: ubuntu-latest
    
    steps:
      - name: Subscribe to YouTube Channels
        run: |
          echo "Starting YouTube channel subscription maintenance..."
          
          # Call the subscribe-channels endpoint
          response=$(curl -s -w "%{http_code}" \
            -X GET \
            "https://andrevargas.com.br/admin/subscribe-channels")
          
          http_code="${response: -3}"
          response_body="${response%???}"
          
          echo "ğŸ“Š HTTP Status Code: $http_code"
          
          if [ "$http_code" -eq 200 ]; then
            echo "âœ… Channel subscription maintenance completed successfully"
            echo "ğŸ“‹ Response: $response_body"
          else
            echo "âŒ Channel subscription maintenance failed"
            echo "ğŸ“‹ Response: $response_body"
            exit 1
          fi
          
      - name: Log Completion
        run: |
          echo "ğŸ¯ YouTube channel subscription maintenance job completed at $(date)"